$Server = "AWSDROIRLW0009"
$TargetUser = "SA-ITS-APSPHINT-LAB"

Write-Host "Checking for 'ompeditor' process on $Server ..." -ForegroundColor Cyan

try {
    $procList = Invoke-Command -ComputerName $Server -ScriptBlock {
        Get-CimInstance Win32_Process | 
            Where-Object { $_.Name -match "ompeditor" } |
            Select-Object ProcessId, Name, CommandLine, 
                @{Name="User"; Expression = { ($_.GetOwner()).User }}, 
                CreationDate
    }

    # Filter by username
    $matched = $procList | Where-Object { $_.User -eq $using:TargetUser }

    if (!$matched) {
        Write-Host "No jobs running." -ForegroundColor Yellow
        exit
    }

    foreach ($p in $matched) {
        Write-Host ""
        Write-Host "Process found:" -ForegroundColor Green
        Write-Host "   PID         : $($p.ProcessId)"
        Write-Host "   Name        : $($p.Name)"
        Write-Host "   User        : $($p.User)"
        Write-Host "   Started On  : $($p.CreationDate)"
        Write-Host "   CommandLine : $($p.CommandLine)"
        Write-Host ""
    }
}
catch {
    Write-Host "Error connecting to server or fetching process. $_" -ForegroundColor Red
}

exit






PS C:\Windows\system32> \\awsiedrofsxn01.jnj.com\pharma_dev_omp\JNJ_PHARMA_LAB\OMPartners\lab\dispatcher\bin\Automation\PAK\Check_Job_Status.ps1
Checking for 'ompeditor' process on AWSDROIRLW0009 ...
Error connecting to server or fetching process. A Using variable cannot be retrieved. A Using variable can be used only with Invoke-Command, Start-Job, or InlineScript in the script 
workflow. When it is used with Invoke-Command, the Using variable is valid only if the script block is invoked on a remote computer.
