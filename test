
def check_job_status(
    ps_script_path: str = r"\\awsiedrofsxn01.jnj.com\pharma_dev_omp\JNJ_PHARMA_LAB\OMPartners\lab\dispatcher\bin\Automation\PAK\Check_Job_Status1.ps1",
    exit_on_running: bool = True,     # DEFAULT: STOP SCRIPT IF JOBS RUNNING
    timeout: int = 60
) -> Tuple[bool, str]:

    logging.info("Job status checking script execution started")

    try:
        result = subprocess.run(
            ["powershell", "-ExecutionPolicy", "Bypass", "-File", ps_script_path],
            capture_output=True,
            text=True,
            timeout=timeout
        )

        output = result.stdout.strip()
        logging.info("PowerShell Output:\n%s", output)

        # Determine job status
        jobs_running = "No jobs running" not in output

        # -------------------------
        #   MAIN DECISION LOGIC
        # -------------------------

        if jobs_running:
            logging.info("Jobs are Running")

            if exit_on_running:
                logging.error("Stopping Python execution because jobs are running")
                sys.exit(1)    # ← FULL PYTHON EXIT (exactly as you want)

            # If exit_on_running=False → still block continuation
            raise RuntimeError("Jobs are running — cannot continue with deployment")

        # If no jobs, allow next steps
        logging.info("No jobs running. Continuing workflow…")
        return False, output

    except subprocess.TimeoutExpired:
        logging.error("PowerShell script timed out after %s seconds", timeout)
        raise

    except Exception:
        logging.exception("Unexpected error while checking job status")
        raise
